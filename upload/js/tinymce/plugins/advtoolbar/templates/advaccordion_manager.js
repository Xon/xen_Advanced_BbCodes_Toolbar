!function(n){XenForo.Adv_Template_Accordion={AjaxResponse:!1,init:function(t){var i=XenForo.Adv_Template_Accordion,r;if(i.isMiu=!1,t.hasClass("isMiu")?(i.isMiu=!0,r=XenForo.MiuFramework.miu.selection):(i.ed=typeof tinyMCEPopup!="undefined"?tinyMCEPopup.editor:XenForo.tinymce.ed,r=i.ed.selection.getContent()),r.length!=0){if(i.AjaxResponse===!1)return i.globalElement=t,XenForo.ajax("index.php?editor/to-bb-code",{html:r},i.html2bbcode),!1;t.find("#slide_content_1").val(i.AjaxResponse).animate({height:"75px"},"fast")}i.bakeBasics(t),t.find("#createSlide").click(function(){var u=n("#slides").children().length+1,f=t.find("#model").html().replace(/replaceid/g,u);n(f).appendTo("#slides"),i.bakeBasics(t),n("#slide_content_"+u).focus()})},bakeBasics:function(t){var i=XenForo.Adv_Template_Accordion,r,u;if($ctrl_width=t.find("#ctrl_width"),$widthtype=t.find("#ctrl_widthtype").hide(),$cmd_height=t.find(".CMD_Height"),t.find(".heightpx").hide(),$masterheight=t.find("#MasterHeight").css("visibility","hidden"),i.isMiu==!1)var o=i.ed.getParam("advtoolbar_template_strechedtitlewidth"),e=i.ed.getParam("advtoolbar_template_normaltitlewidth"),f=i.ed.getParam("advtoolbar_template_phrase_auto");else var o=t.attr("data-streched-width"),e=t.attr("data-normal-width"),f=t.attr("data-auto");r=$cmd_height.children("input").val(),u=$cmd_height.children("input").css("width"),$ctrl_width.one("focus",function(){n(this).val("")}).focus(function(){$widthtype.show("fast"),n(this).val()==f&&n(this).val("")}).focusout(function(){var t=n(this).val(),e=new RegExp("[０-９]+");e.test(t)&&(t=i.zen2han(t),n(this).val(t)),n(this).val().length==0||isNaN(n(this).val())?($widthtype.hide("fast"),n(this).val(f),$masterheight.css("visibility","hidden").children("input").val(r).css("width",u)):$masterheight.css("visibility","visible")}),$widthtype.click(function(){n(this).val()=="%"?n(this).val("px"):n(this).val("%")}),isNaN(n("#MasterHeight input").val())||n(".CMD_Height").not("#MasterHeight").hide(),$cmd_height.children("input").one("focus",function(){n(this).val("")}).focus(function(){n(this).next(".heightpx").show("fast"),n(this).val()==r&&n(this).val(""),n(this).animate({width:"30px"},function(){})}).focusout(function(){var t=n(this).val(),f=new RegExp("[０-９]+");f.test(t)&&(t=i.zen2han(t),n(this).val(t)),n(this).val().length==0||isNaN(n(this).val())?(n(this).animate({width:u},function(){n(this).val(r)}),n(this).parent().attr("id")=="MasterHeight"&&n(".CMD_Height").not("#MasterHeight").show("slow")):n(this).parent().attr("id")=="MasterHeight"&&(n(".CMD_Height").not("#MasterHeight").hide("slow"),n(".CMD_Height input").not("#MasterHeight input").val(r).css("width",u)),n(this).next(".heightpx").hide()}),t.find(".CMD_Title").children("input").one("focus",function(){data_ctrl_title_width=n(this).css("width"),n(this).val("")}).focus(function(){n(this).parent().nextAll("li").hide(),n(this).animate({width:"300px"},"fast")}).focusout(function(){$fout=n(this),n(this).animate({width:e},function(){isNaN(n("#MasterHeight input").val())?$fout.parent().nextAll("li").show():$fout.parent().nextAll("li:not(.CMD_Height)").show()})}),t.find(".CMD_Align li").click(function(){$align_target_button=n(this).children("div"),$align_target_form=n(this).parent().next("input"),n(this).parent().children("li").children("div").removeClass("align_select_left align_select_center align_select_right"),$align_target_button.hasClass("align_left")?($align_target_button.addClass("align_select_left"),$align_target_form.val("left")):$align_target_button.hasClass("align_center")?($align_target_button.addClass("align_select_center"),$align_target_form.val("center")):$align_target_button.hasClass("align_right")&&($align_target_button.addClass("align_select_right"),$align_target_form.val("right"))}),t.find(".slide_content").children("textarea").focus(function(){n(this).animate({height:"75px"},"fast")}).focusout(function(){n(this).animate({height:"15px"},"fast")}),t.find(".deleteSlide").bind("click",function(){n(this).parent().parent().remove(),i.updateID()})},updateID:function(){var t=1;n(".slide").not(n("#model .slide")).each(function(){n(this).attr("id","slide_"+t),n(this).find(".CMD_Title input").attr("id","slide_title_"+t).attr("name","slidetitle"+t),n(this).find(".CMD_Align input").attr("id","slide_align_"+t).attr("name","slidealign"+t),n(this).find(".CMD_Height input").attr("id","slide_height_"+t).attr("name","slideheight"+t),n(this).find(".CMD_Open input").attr("id","slide_open_"+t).attr("name","slideopen"+t),n(this).find(".CMD_Content textarea").attr("id","slide_content_"+t).attr("name","slidecontent"+t),n(this).find(".CMD_Id").text(t),t++})},zen2han:function(n){for(var t,r="",i=0,u=n.length;i<u;i++)t=n.charCodeAt(i),t=t>=65281&&t<=65392?t-65248:t,t=t===12540?45:t,r=r+String.fromCharCode(t);return r},unescapeHtml:function(n,t){n=n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),t=="space"&&(n=n.replace(/    /g,"\t").replace(/&nbsp;/g,"  ").replace(/<\/p>\n<p>/g,"\n"));var i=new RegExp("^<p>([\\s\\S]+)</p>$","i");return i.test(n)&&(n=n.match(i),n=n[1]),n},html2bbcode:function(n){if(!XenForo.hasResponseError(n)){var t=XenForo.Adv_Template_Accordion;return t.AjaxResponse=n.bbCode,t.init(t.globalElement),!1}}},XenForo.register("#adv_accordion","XenForo.Adv_Template_Accordion.init")}(jQuery,this,document);